<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 Â· å”å¹¼æ–°æ˜¥</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Ma+Shan+Zheng&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-paper: #F9F7F2; 
            --ink: #2C2C2C;      
            --red: #B71C1C;      
            --gold: #D4AF37;     
        }

        body, html {
            width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
            background-color: var(--bg-paper); font-family: 'Noto Serif SC', serif;
            color: var(--ink); user-select: none; touch-action: none; cursor: grab;
        }
        body:active { cursor: grabbing; }

        /* --- 1. å¼€å±é¡µ --- */
        #entrance-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-paper); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s ease-in-out; /* åŠ å¿«æ¶ˆå¤±é€Ÿåº¦ */
            background-image: radial-gradient(#e0e0e0 1px, transparent 0);
            background-size: 20px 20px;
        }

        /* çº¯å‡€åœ†å½¢æŒ‰é’® */
        .start-bubble {
            width: 110px; height: 110px; border-radius: 50%;
            background: #D32F2F; /* æ›´é²œè‰³çš„çº¢ */
            display: flex; align-items: center; justify-content: center;
            color: #fff; font-family: 'Ma Shan Zheng'; font-size: 36px;
            box-shadow: 0 10px 30px rgba(211, 47, 47, 0.5);
            cursor: pointer; margin-top: 40px;
            transition: transform 0.1s;
            position: relative; z-index: 10;
            border: 2px solid rgba(255,255,255,0.2);
        }
        .start-bubble:active { transform: scale(0.9); }
        .start-bubble.popped { transform: scale(1.5); opacity: 0; transition: all 0.15s ease-out; }

        /* --- 2. åŸºç¡€å¸ƒå±€ --- */
        #flow-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; opacity: 0.8; }
        /* çˆ†ç‚¸ç²’å­å±‚ï¼šå¿…é¡»åœ¨å¼€å±é¡µä¹‹ä¸Š */
        #burst-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; pointer-events: none; }

        .footer-mark {
            position: fixed; bottom: 12px; left: 0; width: 100%; text-align: center;
            font-size: 10px; color: var(--ink); opacity: 0.3; letter-spacing: 4px; pointer-events: none; z-index: 150;
            animation: breathe-text 4s ease-in-out infinite;
        }
        @keyframes breathe-text { 0%, 100% { opacity: 0.2; } 50% { opacity: 0.5; } }

        .music-wrapper { position: fixed; top: 20px; right: 20px; z-index: 200; display: flex; flex-direction: column; align-items: center; gap: 8px; opacity: 0; transition: opacity 1s; }
        .music-dot { width: 36px; height: 36px; border: 1px solid var(--ink); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(2px); transition: all 0.3s; }
        .music-dot.playing { border-color: var(--red); background: rgba(183, 28, 28, 0.05); animation: rotate 8s linear infinite; }
        @keyframes rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .music-dot::after { content: 'â™ª'; font-size: 14px; color: var(--ink); }
        .music-dot.playing::after { color: var(--red); }
        .change-song-btn { font-size: 10px; color: #666; border: 1px solid #ccc; padding: 2px 6px; border-radius: 4px; background: rgba(255,255,255,0.8); cursor: pointer; }

        /* --- 3. å¹»ç¯ç‰‡ (å…¨ç«¯é€‚é…æ ¸å¿ƒ) --- */
        .slide {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box;
            opacity: 0; pointer-events: none;
            transition: opacity 1.2s cubic-bezier(0.2, 1, 0.3, 1), transform 1.2s cubic-bezier(0.2, 1, 0.3, 1);
            transform: translateY(40px);
        }
        .slide.active { opacity: 1; pointer-events: auto; transform: translateY(0); z-index: 10; }

        /* å“åº”å¼å­—ä½“ */
        .big-title { 
            font-family: 'Ma Shan Zheng'; 
            /* æ‰‹æœºå¤§å­—ï¼Œç”µè„‘é€‚ä¸­ */
            font-size: clamp(3.5rem, 10vw, 5rem); 
            line-height: 1.1; 
            background: linear-gradient(45deg, var(--ink), #555); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            margin-bottom: 2rem; text-align: center; 
        }
        .vertical-text { 
            writing-mode: vertical-rl; text-orientation: mixed; font-family: 'Zhi Mang Xing'; 
            font-size: clamp(2rem, 5vw, 3rem); 
            letter-spacing: 0.5rem; color: var(--ink); opacity: 0.9; 
        }
        .red-stamp { border: 1px solid var(--red); color: var(--red); padding: 4px 12px; border-radius: 4px; font-size: 0.9rem; letter-spacing: 2px; margin-top: 2rem; display: inline-block; font-weight: bold;}
        .number-art { font-family: 'Noto Serif SC', serif; font-size: clamp(5rem, 15vw, 8rem); font-weight: 700; color: rgba(183, 28, 28, 0.1); position: absolute; z-index: -1; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        
        .couplet-strip { 
            writing-mode: vertical-rl; padding: 20px 12px; font-family: 'Zhi Mang Xing'; 
            font-size: clamp(1.5rem, 4vw, 2.2rem); 
            letter-spacing: 0.2rem; border: 1px solid rgba(0,0,0,0.1); background: rgba(255,255,255,0.4); 
            transition: all 0.5s ease; cursor: default; 
        }
        .couplet-strip:hover { border-color: var(--red); transform: translateY(-5px); background: rgba(255,255,255,0.8); }
        
        .polaroid { background: white; padding: 10px 10px 30px 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transform: rotate(-1deg); transition: transform 0.5s ease; width: 260px; }
        .polaroid:hover { transform: rotate(0deg) scale(1.02); }
        .polaroid-img { width: 100%; height: 180px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #ccc; font-size: 3rem; }
        
        .progress-bar { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); width: 120px; height: 2px; background: rgba(0,0,0,0.1); z-index: 100; border-radius: 2px; overflow: hidden; }
        .progress-inner { height: 100%; background: var(--red); width: 0%; transition: width 0.6s ease; }
        .trans-en { opacity: 0; transition: opacity 0.8s; font-style: italic; color: var(--red); font-size: clamp(1rem, 2.5vw, 1.25rem); }

        /* --- 4. ç´§å‡‘æ’ç‰ˆä¿¡çº¸ (ä¸‰ç«¯é€šç”¨é€‚é…) --- */
        .scroll-letter {
            width: 90%;
            /* å…³é”®ï¼šé™åˆ¶æœ€å¤§å®½åº¦ï¼Œé˜²æ­¢ç”µè„‘ç«¯ä¸€è¡Œå­—å¤ªé•¿ */
            max-width: 480px; 
            height: 60vh;
            /* å±…ä¸­ */
            margin: 0 auto;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(8px);
            padding: 24px;
            border-radius: 12px;
            border: 1px solid rgba(183, 28, 28, 0.15);
            box-shadow: 0 8px 30px rgba(0,0,0,0.05);
            scrollbar-width: thin;
            scrollbar-color: rgba(183, 28, 28, 0.3) transparent;
            padding-bottom: 60px; 
        }
        .scroll-letter::-webkit-scrollbar { width: 3px; }
        .scroll-letter::-webkit-scrollbar-thumb { background-color: rgba(183, 28, 28, 0.3); border-radius: 4px; }

        /* æåº¦ç´§å‡‘çš„æ–‡å­—æ’ç‰ˆ - é€‚é…è°ƒæ•´ */
        .blessing-p { 
            margin-bottom: 8px; /* æ®µé—´è· */
            text-indent: 2em; 
            text-align: justify; 
            /* è¡Œé«˜å’Œå­—é—´è·ä¼˜åŒ– */
            line-height: 1.6; 
            font-size: 0.95rem;
            letter-spacing: 0.02em; /* ç¨å¾®ç´§ä¸€ç‚¹ï¼Œä¸è¦å¤ªå¼€ */
            color: #3e2723;
        }
        /* ç”µè„‘ç«¯å­—ä½“ç¨å¤§ä¸€ç‚¹ç‚¹ */
        @media (min-width: 768px) {
            .blessing-p { font-size: 1.05rem; margin-bottom: 10px; }
        }

        .blessing-title { 
            font-weight: 700; 
            margin-bottom: 4px; 
            margin-top: 14px; 
            text-indent: 0; 
            display: block; 
            color: var(--red); 
            font-size: 1rem;
        }
        .blessing-header { 
            font-family: 'Ma Shan Zheng'; 
            font-size: 1.5rem; 
            color: var(--red); 
            text-align: center; 
            margin-bottom: 16px; 
            text-indent: 0; 
            line-height: 1.3;
        }

        #read-indicator { margin-top: 12px; font-size: 10px; color: #999; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        #read-icon { font-size: 14px; animation: bounce 1.5s infinite; }
        #read-indicator.unlocked { color: var(--red); font-weight: bold; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(3px); } }

        .char-jump { display: inline-block; opacity: 0; transform: translateY(3px); animation: jumpIn 0.2s ease-out forwards; }
        @keyframes jumpIn { to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="footer-mark">å”å¹¼æ–°æ˜¥ - 2026</div>

    <!-- 1. å¼€å± -->
    <div id="entrance-screen">
        <p class="text-xs tracking-[0.5em] text-gray-400 mb-4 uppercase">HAPPY NEW YEAR</p>
        <h1 class="text-5xl font-serif text-[#2C2C2C] mb-2" style="font-family: 'Ma Shan Zheng'">å¸ˆç”Ÿäº²å¯</h1>
        <p class="text-sm text-gray-500 font-serif tracking-widest mb-8">äºŒé›¶äºŒå…­ Â· ä¸™åˆæ–°æ˜¥</p>
        
        <!-- å¼€å¯æŒ‰é’® -->
        <div class="start-bubble" id="start-btn">å¼€å¯</div>
        
        <p class="mt-12 text-[10px] text-gray-400 opacity-60"><span id="loading-hint">ç‚¹å‡»å¼€å¯ æ’­æ”¾éŸ³ä¹</span></p>
    </div>

    <!-- èƒŒæ™¯ç”»å¸ƒ -->
    <canvas id="flow-canvas"></canvas>
    <!-- çˆ†ç‚¸ç²’å­ç”»å¸ƒ (å±‚çº§æœ€é«˜) -->
    <canvas id="burst-canvas"></canvas>
    
    <div class="music-wrapper" id="music-dock">
        <div class="music-dot" id="music-btn" title="æ’­æ”¾/æš‚åœ"></div>
        <div class="change-song-btn" onclick="document.getElementById('file-upload').click()">æ¢æ­Œ</div>
        <input type="file" id="file-upload" accept="audio/*" style="display: none;">
    </div>

    <audio id="audio" loop preload="auto">
        <source src="æ˜¥é£åé‡ŒæŠ¥æ–°å¹´ - æ¥ä¸ªå»ï¼Œå¼€ä¸€æªã€ç«é¸¡ã€å•å£å£ã€Lambertã€æ¨èƒ–é›¨.mp3" type="audio/mpeg">
        <source src="https://upload.wikimedia.org/wikipedia/commons/e/ec/Guzheng_connect.ogg" type="audio/ogg">
    </audio>

    <main>
        <!-- P1: å°é¢ -->
        <section class="slide active">
            <p class="text-xs tracking-[0.5em] text-gray-400 mb-8 uppercase">A.D. 2026</p>
            <h1 class="big-title">å²åº<br>å¸¸æ˜“</h1>
            <div class="w-8 h-[2px] bg-red-800 my-8 opacity-50"></div>
            <p class="text-sm text-gray-600 tracking-widest">åç« æ—¥æ–° Â· ä¸™åˆå¤§å‰</p>
            <div class="red-stamp">è‡´ å…¨ä½“å¸ˆç”Ÿ</div>
            <div class="absolute bottom-16 text-[10px] opacity-30 animate-bounce">â†“ æ»‘åŠ¨ç¿»é¡µ</div>
        </section>

        <!-- P2: å²æœˆ -->
        <section class="slide">
            <div class="number-art">365</div>
            <h2 class="text-3xl font-serif mb-6 z-10">æºæ‰‹åŒè¡Œ</h2>
            <div class="w-full max-w-xs text-center leading-loose text-sm text-gray-600 z-10">
                <p>ä¸‰ç™¾å…­åäº”ä¸ªæ—¥å¤œ</p>
                <p>æ˜¯ä¹¦å£°ç…ç…çš„æ¸…æ™¨</p>
                <p>æ˜¯ç¯ç«é€šæ˜çš„å¤œæ™š</p>
            </div>
            <div class="mt-12 text-xs text-red-800 opacity-60 tracking-[0.2em] z-10">OUR SHARED JOURNEY</div>
        </section>

        <!-- P3: æ²‰æ·€ -->
        <section class="slide">
            <div class="flex flex-row-reverse gap-4 md:gap-12 items-center justify-center h-full w-full max-w-2xl">
                <div class="vertical-text" style="border-right: 1px solid rgba(0,0,0,0.1); padding-right: 20px;">
                    ç§¯æ·€
                </div>
                <div class="text-left leading-loose text-gray-600 font-serif text-sm tracking-wide" style="writing-mode: vertical-rl;">
                    ä¹™å·³çµè›‡ Â· æ½œå¿ƒç¬ƒè¡Œ<br>
                    æ•™å­¦ç›¸é•¿ Â· äº¦å¸ˆäº¦å‹<br>
                    æ— è®ºæ˜¯è®²å°è¿˜æ˜¯è¯¾æ¡Œ<br>
                    çš†æ˜¯æˆé•¿çš„æ²ƒåœŸ
                </div>
            </div>
        </section>

        <!-- P4: å¸ˆé­‚ (ä¿®æ”¹ï¼šå”å¹¼å¸ˆç”Ÿ) -->
        <section class="slide">
            <div class="flex gap-4 md:gap-16 justify-center items-center w-full">
                <div class="couplet-strip">æ»¡å›­æ¡ƒæäº‰æ˜¥è‰²</div>
                <div class="couplet-strip">å”å¹¼å¸ˆç”Ÿè°±åç« </div>
            </div>
            <div class="red-stamp">å…±å‹‰</div>
        </section>

        <!-- P5: è…¾é£ -->
        <section class="slide">
            <div class="flex flex-row gap-4 md:gap-12 items-center justify-center h-full w-full max-w-2xl">
                <div class="vertical-text" style="color: var(--red); border-left: 1px solid rgba(183, 28, 28, 0.1); padding-left: 20px;">
                    è…¾é£
                </div>
                <div class="text-right leading-loose text-gray-600 font-serif text-sm tracking-wide" style="writing-mode: vertical-rl;">
                    ä¸™åˆé¾™é©¬ Â· å¥‹è¹„æ‰¬é¬ƒ<br>
                    æ„¿æˆ‘ä»¬ Â· ä¹˜é£ç ´æµª<br>
                    å†åˆ›ä½³ç»© Â· ä¸‡äº‹é¡ºé‚
                </div>
            </div>
        </section>

        <!-- P6: ç¿»è¯‘ -->
        <section class="slide">
            <div class="w-full text-center p-8 cursor-pointer" onclick="revealTrans()">
                <div id="cn-text" class="transition-all duration-1000">
                    <h2 class="text-4xl md:text-5xl mb-6" style="font-family: 'Zhi Mang Xing'">
                        é”¦ç»£å‰ç¨‹<br>æœªæ¥å¯æœŸ
                    </h2>
                    <p class="text-xs text-gray-400 tracking-widest mt-12">ç‚¹å‡» Â· è¯‘</p>
                </div>
                <div id="en-text" class="trans-en absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full text-center px-4">
                    <p class="text-xl leading-relaxed">
                        "A bright and splendid future awaits us all.<br>
                        Let's embrace the promising tomorrow."
                    </p>
                </div>
            </div>
        </section>

        <!-- P7: ç´§å‡‘é•¿æ–‡æ¡ˆ (æ ¸å¿ƒä¿®æ”¹) -->
        <section class="slide">
            <div class="scroll-letter" id="letter-box">
                <div id="long-text-container" class="font-serif"></div>
            </div>
            
            <div id="read-indicator">
                <span id="read-icon">ğŸ”’</span>
                <span id="read-msg">è¯·ä¸‹æ»‘é˜…è¯»å…¨æ–‡</span>
            </div>
        </section>

        <!-- P8: ç¥ç¦ -->
        <section class="slide">
            <h2 class="text-4xl mb-12" style="font-family: 'Ma Shan Zheng'; color: var(--red);">å¿ƒæ„</h2>
            <div class="grid grid-cols-2 gap-8 w-full max-w-xs">
                <div class="text-center cursor-pointer opacity-60 hover:opacity-100 transition duration-500" onclick="vibrate()">
                    <div class="text-2xl font-bold mb-2 font-serif">å®‰</div><div class="text-[10px] uppercase tracking-widest">Peace</div>
                </div>
                <div class="text-center cursor-pointer opacity-60 hover:opacity-100 transition duration-500" onclick="vibrate()">
                    <div class="text-2xl font-bold mb-2 font-serif">é¡º</div><div class="text-[10px] uppercase tracking-widest">Flow</div>
                </div>
                <div class="text-center cursor-pointer opacity-60 hover:opacity-100 transition duration-500" onclick="vibrate()">
                    <div class="text-2xl font-bold mb-2 font-serif">å–œ</div><div class="text-[10px] uppercase tracking-widest">Joy</div>
                </div>
                <div class="text-center cursor-pointer opacity-60 hover:opacity-100 transition duration-500" onclick="vibrate()">
                    <div class="text-2xl font-bold mb-2 font-serif">å‰</div><div class="text-[10px] uppercase tracking-widest">Luck</div>
                </div>
            </div>
            <div class="absolute bottom-16 text-[10px] text-gray-300">å”å¹¼å¸ˆç”Ÿ æ•¬è´º</div>
        </section>
    </main>

    <div class="progress-bar"><div class="progress-inner" id="progress"></div></div>

    <script>
        // --- 1. Canvasç‰¹æ•ˆ (æµé‡‘èƒŒæ™¯ + çˆ†ç‚¸) ---
        const cvs = document.getElementById('flow-canvas');
        const ctx = cvs.getContext('2d');
        const bCvs = document.getElementById('burst-canvas'); // ä¸“é—¨çš„çˆ†ç‚¸ç”»å¸ƒ
        const bCtx = bCvs.getContext('2d');
        
        let cW, cH, bgPts=[], burstPts=[], trailPts=[];

        function initCanvas() {
            cW = window.innerWidth; cH = window.innerHeight;
            cvs.width = cW; cvs.height = cH;
            bCvs.width = cW; bCvs.height = cH;
            
            bgPts = [];
            for(let i=0; i<(cW<500?50:100); i++) {
                bgPts.push({x:Math.random()*cW, y:Math.random()*cH, vx:(Math.random()-.5)*.3, vy:(Math.random()-.5)*.3, r:Math.random()*2, a:Math.random()*.5});
            }
        }
        
        // æ ¸å¿ƒï¼šçº¢è‰²å¤§çˆ†ç‚¸ (Big Red Explosion)
        function spawnBigRedExplosion(x, y) {
            // 300+ ç²’å­
            for(let i=0; i<300; i++) { 
                const angle = Math.random() * Math.PI * 2;
                // é€Ÿåº¦æ›´å¿«ï¼ŒèŒƒå›´æ›´å¹¿
                const speed = Math.random() * 15 + 2; 
                // é¢œè‰²æ··æ‚ï¼šæ·±çº¢ã€æ­£çº¢ã€æ©™é‡‘
                const colors = ['#D32F2F', '#B71C1C', '#FF5252', '#FFD700'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                burstPts.push({
                    x: x, y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    r: Math.random() * 5 + 2, // ç²’å­æ›´å¤§
                    a: 1,
                    life: 1.0,
                    decay: Math.random() * 0.015 + 0.005, // è¡°å‡æ…¢ä¸€ç‚¹
                    color: color
                });
            }
        }

        // æ‰‹æŒ‡æ‹–å°¾ (é‡‘è‰²)
        function spawnTrail(x, y) {
            for(let i=0; i<3; i++) trailPts.push({x, y, vx:(Math.random()-.5)*4, vy:(Math.random()-.5)*4, r:Math.random()*3+2, a:1});
        }

        function render() {
            // 1. èƒŒæ™¯å±‚
            ctx.clearRect(0, 0, cW, cH);
            ctx.beginPath();
            bgPts.forEach(p => {
                p.x+=p.vx; p.y+=p.vy;
                if(p.x<0||p.x>cW) p.vx*=-1; if(p.y<0||p.y>cH) p.vy*=-1;
                ctx.moveTo(p.x, p.y); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
            });
            ctx.fillStyle="rgba(212,175,55,0.4)"; ctx.fill();
            
            // æ‹–å°¾å±‚
            trailPts.forEach((p, i) => {
                p.x+=p.vx; p.y+=p.vy; p.r*=.94; p.a-=.03;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
                ctx.fillStyle=`rgba(212,175,55,${p.a})`; ctx.fill();
                if(p.a<=0) trailPts.splice(i, 1);
            });

            // 2. çˆ†ç‚¸å±‚ (ç‹¬ç«‹ç”»å¸ƒï¼Œæ¸…ç©º)
            bCtx.clearRect(0, 0, cW, cH);
            burstPts.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy;
                p.vx *= 0.96; p.vy *= 0.96; // é˜»åŠ›
                p.life -= p.decay;
                
                if (p.life > 0) {
                    bCtx.globalAlpha = p.life;
                    bCtx.fillStyle = p.color;
                    bCtx.beginPath();
                    bCtx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                    bCtx.fill();
                } else {
                    burstPts.splice(i, 1);
                }
            });
            bCtx.globalAlpha = 1; // é‡ç½®

            requestAnimationFrame(render);
        }

        // --- 2. äº¤äº’é€»è¾‘ ---
        let cur = 0;
        const slides = document.querySelectorAll('.slide');
        const prog = document.getElementById('progress');
        let startY = 0;
        let isReadingDone = false;

        function update() {
            slides.forEach((s, i) => s.classList.toggle('active', i === cur));
            prog.style.width = ((cur + 1) / slides.length) * 100 + '%';
            if(cur === 6) typeLongText();
        }

        function next() {
            if (cur === 6 && !isReadingDone) {
                const hint = document.getElementById('read-msg');
                hint.style.color = "#d32f2f"; hint.style.transform = "scale(1.1)";
                setTimeout(() => { hint.style.transform = "scale(1)"; hint.style.color = "#999"; }, 300);
                if(navigator.vibrate) navigator.vibrate([50, 50, 50]);
                return; 
            }
            if (cur < slides.length - 1) { cur++; update(); }
        }
        function prev() { if (cur > 0) { cur--; update(); } }

        document.addEventListener('touchstart', e => startY=e.touches[0].clientY, {passive:true});
        document.addEventListener('touchmove', e => spawnTrail(e.touches[0].clientX, e.touches[0].clientY), {passive:true});
        document.addEventListener('touchend', e => {
            const dy = startY - e.changedTouches[0].clientY;
            if(Math.abs(dy) > 50) dy > 0 ? next() : prev();
        });
        window.addEventListener('wheel', e => { if(e.deltaY > 0) next(); else if(e.deltaY < 0) prev(); });
        window.addEventListener('keydown', e => { if(e.key==='ArrowDown') next(); if(e.key==='ArrowUp') prev(); });
        document.addEventListener('mousemove', e => { if(e.buttons===1) spawnTrail(e.clientX, e.clientY); });

        // --- 3. é•¿æ–‡æ¡ˆé€»è¾‘ (ç´§å‡‘é€‚é…ç‰ˆ) ---
        let hasTyped = false;
        function typeLongText() {
            if(hasTyped) return; hasTyped = true;
            const container = document.getElementById('long-text-container');
            const paragraphs = [
                { type: 'header', text: "é©¬å¹´å¥”è…¾é€ç¥ç¦ï¼Œä¸‡è±¡æ›´æ–°å±•å®å›¾" },
                { type: 'normal', text: "è‡´å…¨æ ¡å¸ˆç”Ÿï¼š" },
                { type: 'p', text: "éªé©¬è¿æ˜¥ï¼Œè¹„å£°æ¿€è¶Šã€‚å€¼æ­¤ç”²åˆé©¬å¹´åˆ°æ¥ä¹‹é™…ï¼Œæˆ‘ä»¬è°¨ä»¥æœ€è¯šæŒšçš„å¿ƒæ„ï¼Œå‘å…¨æ ¡è¾›å‹¤è€•è€˜çš„è€å¸ˆä»¬ã€æœæ°”è“¬å‹ƒçš„åŒå­¦ä»¬ï¼Œè‡´ä»¥æ–°æ˜¥çš„ç¥ç¦ä¸ç¾å¥½çš„æœŸç›¼ï¼" },
                { type: 'title', text: "è‡´æ•¬å¸ˆè€…â€”â€”" },
                { type: 'p', text: "æ„¿æ‚¨å¦‚éªé©¬é©°éª‹ï¼Œå¼•é¢†çŸ¥è¯†çš„åŸé‡ï¼Œæ˜¥é£åŒ–é›¨è‚²æ¡ƒæï¼Œæ™ºæ…§ä¹‹å…‰ç‚¹äº®å­¦å­å‰ç¨‹ã€‚æ–°ä¸€å¹´ï¼Œæ„¿æ‚¨äº‹ä¸šæ‰¬é­å¥‹è¹„ï¼Œç”Ÿæ´»å®‰åº·é¡ºæ„ï¼Œæ¡ƒæèŠ¬èŠ³æ»¡å¤©ä¸‹ï¼" },
                { type: 'title', text: "è‡´æ„å­¦å­â€”â€”" },
                { type: 'p', text: "æ„¿ä½ ä»¬ä¼¼é’æ˜¥éªé©¬ï¼Œå¿—å­˜é«˜è¿œï¼Œé©°éª‹å­¦æµ·ï¼›ä»¥æ¢¦ä¸ºéï¼Œä»¥å‹¤ä¸ºé­ï¼Œä¸è´ŸéŸ¶åï¼Œä¹˜é£ç ´æµªã€‚æ–°ä¸€å¹´ï¼Œæ„¿ä½ ä»¬å­¦ä¸šâ€œé©¬åˆ°æˆåŠŸâ€ï¼Œæˆé•¿â€œä¸€é©¬å½“å…ˆâ€ï¼" },
                { type: 'p', text: "é©¬å¹´å°†è‡³ï¼Œè®©æˆ‘ä»¬ä»¥é¾™é©¬ç²¾ç¥ï¼Œæºæ‰‹å¥‹è¿›ï¼š" },
                { type: 'p', text: "æ•™å­¦ç§‘ç ”è·ƒæ–°é«˜ï¼Œæ±‚å­¦æ±‚çŸ¥æ­¥é’äº‘ï¼›æ ¡å›­ç”Ÿæœºå¦‚æ˜¥è‰ï¼Œå¸ˆç”Ÿæƒ…è°Šä¼¼æš–é˜³ã€‚" },
                { type: 'title', text: "ç¥æ„¿å…¨ä½“å¸ˆç”Ÿï¼š" },
                { type: 'p', text: "èº«ä½“å¥ç¡•å¦‚éªé©¬ï¼Œäº‹ä¸šå­¦ä¸šè…¾äº‘éœ„ï¼å®¶åº­å’Œç¦ç¦æ»¡é—¨ï¼Œæ–°å¹´å¿«ä¹ä¸‡äº‹å…´ï¼" },
                { type: 'p', text: "æ„¿æˆ‘ä»¬ï¼šé©¬æ­¥ç”Ÿé£è¿ç››ä¸–ï¼ŒåŒå¿ƒå…±èµ´æ–°å¾ç¨‹ï¼ç¥é©¬å¹´å‰ç¥¥ï¼Œé¹ç¨‹ä¸‡é‡Œï¼" }
            ];
            container.innerHTML = '';
            
            let globalDelay = 0;
            const charSpeed = 0.03; 

            paragraphs.forEach(section => {
                const p = document.createElement('div');
                if (section.type === 'header') p.className = 'blessing-header';
                else if (section.type === 'title') p.className = 'blessing-title';
                else p.className = 'blessing-p';

                section.text.split('').forEach(char => {
                    const span = document.createElement('span');
                    if (char === '\n') p.appendChild(document.createElement('br'));
                    else {
                        span.textContent = char;
                        span.className = 'char-jump';
                        span.style.animationDelay = `${globalDelay}s`;
                        p.appendChild(span);
                        globalDelay += charSpeed;
                    }
                });
                container.appendChild(p);
                globalDelay += 0.1;
            });

            // æ»šåŠ¨æ£€æµ‹
            const box = document.getElementById('letter-box');
            const ind = document.getElementById('read-indicator');
            const icon = document.getElementById('read-icon');
            const msg = document.getElementById('read-msg');
            box.addEventListener('scroll', () => {
                if (box.scrollTop + box.clientHeight >= box.scrollHeight - 50) {
                    if (!isReadingDone) {
                        isReadingDone = true;
                        ind.classList.add('unlocked');
                        icon.textContent = "ğŸ”“"; icon.style.animation = "none";
                        msg.textContent = "å·²é˜…è¯»å®Œæ¯•ï¼Œä¸‹æ»‘ç»§ç»­";
                        if(navigator.vibrate) navigator.vibrate(50);
                    }
                }
            });
        }

        // --- 4. å¼€å¯ & éŸ³ä¹ ---
        const audio = document.getElementById('audio');
        const mBtn = document.getElementById('music-btn');
        const entrance = document.getElementById('entrance-screen');
        const startBtn = document.getElementById('start-btn');
        const musicDock = document.getElementById('music-dock');
        let playing = false;

        audio.addEventListener('error', () => console.log('Audio fallback'));

        startBtn.onclick = (e) => {
            // 1. è§¦å‘å¤§çˆ†ç‚¸
            const rect = startBtn.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            spawnBigRedExplosion(centerX, centerY);

            // 2. æŒ‰é’®æ¶ˆå¤±
            startBtn.classList.add('popped');

            // 3. æ’­æ”¾
            audio.play().then(() => { playing = true; mBtn.classList.add('playing'); }).catch(e => console.log(e));

            // 4. å»¶è¿Ÿéšè—å¼€å±
            setTimeout(() => {
                entrance.style.opacity = '0';
                setTimeout(() => { entrance.style.display = 'none'; musicDock.style.opacity = '1'; }, 600);
            }, 300);
        };

        mBtn.onclick = (e) => {
            e.stopPropagation();
            if(playing) { audio.pause(); mBtn.classList.remove('playing'); playing=false; }
            else { audio.play(); mBtn.classList.add('playing'); playing=true; }
        };

        document.getElementById('file-upload').onchange = (e) => {
            if (e.target.files[0]) {
                audio.src = URL.createObjectURL(e.target.files[0]);
                audio.play().then(() => { playing = true; mBtn.classList.add('playing'); });
            }
        };

        let isTrans = false;
        function revealTrans() {
            if(isTrans) return; isTrans=true;
            const cn = document.getElementById('cn-text');
            const en = document.getElementById('en-text');
            cn.style.filter="blur(10px)"; cn.style.opacity="0";
            setTimeout(() => en.style.opacity="1", 600);
        }
        function vibrate() { if(navigator.vibrate) navigator.vibrate(20); }

        window.onload = () => { initCanvas(); render(); update(); };
        window.onresize = initCanvas;

    </script>
</body>
</html>
